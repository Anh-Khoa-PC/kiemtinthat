<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Hệ thống kiểm tra tin giả bằng AI tiên tiến, giúp nhận biết thông tin sai lệch với độ chính xác cao">
    <title>Kiểm Tin Thật - Hệ thống kiểm tra tin giả bằng AI chính xác</title>

    <meta name="keywords" content="kiểm tra tin giả, fake news, kiểm tra thông tin, AI xác thực tin tức">
    <meta property="og:title" content="Kiểm Tin Thật - Hệ thống kiểm tra tin giả bằng AI">
    <meta property="og:description" content="Công cụ kiểm tra tính xác thực của tin tức bằng AI với độ chính xác cao">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="logo.png">
    
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --danger-color: #dc2626;
            --warning-color: #d97706;
            --success-color: #059669;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        
        .btn {
            transition: all 0.2s ease;
            font-weight: 500;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        /* Loader with progress bar */
        .loading-animation {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .loading-animation .loader {
            border: 5px solid #f3f4f6;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s cubic-bezier(0.5, 0.1, 0.4, 0.9) infinite;
            margin-bottom: 15px;
        }

        .progress-bar-container {
            width: 80%;
            background-color: #e2e8f0;
            border-radius: 9999px;
            height: 8px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-bar {
            height: 100%;
            width: 0%; /* Initial width */
            background-color: var(--primary-color);
            border-radius: 9999px;
            transition: width 0.3s ease-in-out;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-card {
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .score-badge {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.35rem 1rem;
            border-radius: 20px;
        }
        
        .tab-active {
            position: relative;
            color: var(--primary-color);
        }
        
        .tab-active:after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px 3px 0 0;
        }
        
        /* Toast/Snackbar styles */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none; /* Allows clicks to pass through */
        }

        .toast {
            background-color: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: translateY(20px);
            min-width: 250px;
            text-align: center;
            pointer-events: auto; /* Re-enable pointer events for the toast itself */
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1.25rem;
                margin: 1rem auto;
                border-radius: 12px;
            }
            
            .btn {
                padding: 0.65rem 1.25rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body class="bg-white-50">
    <header class="bg-white shadow-xl py-5 sticky top-0 z-50">
        <nav class="container mx-auto flex justify-between items-center px-6 lg:px-8">
            <a href="#home" class="text-3xl font-extrabold text-blue-700 tracking-tight">Kiểm Tin Thật</a>
            <div class=" md:flex space-x-8">
                <a href="index.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Trang chủ</a>
                <a href="check-news.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Kiểm tra tin giả</a>
                <a href="reports.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Báo Cáo</a>
                <a href="fact-checking-guide.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Kiến Thức</a>
                <a href="about-us.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Về chúng tôi</a>
                <a href="contribute.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Đóng góp / Ủng hộ</a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-700 focus:outline-none p-2 rounded-md hover:bg-gray-100 transition duration-200">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-white mt-3 py-3 shadow-lg rounded-xl mx-4">
            <a href="index.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">Trang chủ</a>
            <a href="check-news.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">Kiểm tra tin giả</a>
            <a href="chatbot-ai.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">Báo Cáo</a>
            <a href="fact-checking-guide.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Kiến Thức</a>
            <a href="about-us.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">Về chúng tôi</a>
            <a href="contribute.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">Đóng góp / Ủng hộ</a>
        </div>
    </header>
    </header>

    <main class="py-8">
        <div class="container mx-auto px-4">
            <section class="text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">Kiểm tra độ tin cậy của thông tin</h1>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Sử dụng công nghệ AI tiên tiến để phân tích và đánh giá tính xác thực của tin tức, bài báo hoặc thông tin trực tuyến
                </p>
            </section>
            
            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="flex border-b">
                    <button id="tabUrl" class="tab-btn active flex-1 py-4 font-medium" data-tab="url-tab">
                        <i class="fas fa-link mr-2"></i> Kiểm tra URL
                    </button>
                    <button id="tabText" class="tab-btn flex-1 py-4 font-medium" data-tab="text-tab">
                        <i class="fas fa-align-left mr-2"></i> Kiểm tra văn bản
                    </button>
                </div>
                
                <div class="p-6">
                    <div id="url-tab" class="tab-content">
                        <div class="mb-4">
                            <label for="urlInput" class="block text-sm font-medium text-gray-700 mb-2">
                                Nhập URL bài viết cần kiểm tra
                            </label>
                            <div class="flex">
                                <input type="url" id="urlInput" class="flex-grow px-4 py-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="https://example.com/news-article">
                                <button id="submitUrlBtn" class="bg-blue-600 text-white px-6 py-3 rounded-r-lg hover:bg-blue-700 transition">
                                    Kiểm tra
                                </button>
                            </div>
                            <div id="urlError" class="text-red-500 text-sm mt-2 hidden"></div>
                        </div>
                        
                        <div class="text-sm text-gray-500">
                            <p><i class="fas fa-info-circle mr-2"></i> Hệ thống hỗ trợ kiểm tra các bài báo, tin tức từ hầu hết các trang web tin tức phổ biến.</p>
                        </div>
                    </div>
                    
                    <div id="text-tab" class="tab-content hidden">
                        <div class="mb-4">
                            <label for="textInput" class="block text-sm font-medium text-gray-700 mb-2">
                                Dán nội dung cần kiểm tra
                            </label>
                            <textarea id="textInput" rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Dán nội dung tin tức bạn muốn kiểm tra vào đây..."></textarea>
                            <div id="textError" class="text-red-500 text-sm mt-2 hidden"></div>
                        </div>
                        
                        <button id="submitTextBtn" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                            Phân tích văn bản
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="loadingIndicator" class="mt-8 text-center hidden">
                <div class="loading-animation">
                    <div class="loader"></div>
                    <h3 class="text-lg font-medium text-gray-700">Đang phân tích nội dung</h3>
                    <p class="text-gray-500">Hệ thống AI đang xử lý và đánh giá thông tin của bạn...</p>
                    <div class="progress-bar-container">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>
                </div>
                
                <div class="mt-6 bg-blue-50 border-l-4 border-blue-500 p-4 text-left max-w-2xl mx-auto">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-lightbulb text-blue-500"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-blue-700">
                                <strong>Mẹo:</strong> Trong khi chờ đợi, bạn có thể xem <a href="fact-checking-guide.html" class="underline">hướng dẫn kiểm tra thông tin</a> để tự đánh giá tính xác thực của tin tức.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="resultSection" class="mt-8 hidden">
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="p-6 border-b">
                        <h2 class="text-2xl font-bold text-gray-800">Kết quả phân tích</h2>
                    </div>
                    
                    <div class="p-6">
                        <div class="mb-6">
                            <h3 class="text-lg font-medium text-gray-700 mb-2">Thông tin nguồn</h3>
                            <div class="flex items-start">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                    <i id="sourceIcon" class="fas fa-link text-blue-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p id="sourceType" class="text-sm font-medium text-gray-500">URL bài viết</p>
                                    <p id="sourceContent" class="text-blue-600 break-words"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-lg font-medium text-gray-700 mb-3">Độ tin cậy</h3>
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div id="trustScoreCircle" class="h-16 w-16 rounded-full flex items-center justify-center text-white font-bold text-xl">
                                        75%
                                    </div>
                                </div>
                                <div class="ml-4 flex-1">
                                    <div class="flex items-center justify-between mb-1">
                                        <span class="text-sm font-medium text-gray-500">Độ tin cậy</span>
                                        <span id="trustScoreText" class="text-sm font-medium">Cao</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div id="trustScoreBar" class="h-2.5 rounded-full" style="width: 75%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-lg font-medium text-gray-700 mb-3">Phân tích chi tiết</h3>
                            <div id="analysisDetails" class="space-y-3">
                                </div>
                        </div>
                        
                        <div id="recommendationSection" class="p-4 rounded-lg">
                            <h4 class="font-bold text-lg mb-2">Khuyến nghị</h4>
                            <div id="recommendationContent" class="text-sm">
                                </div>
                        </div>
                        
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <h3 class="text-lg font-medium text-gray-700 mb-3">Đánh giá của bạn về kết quả này?</h3>
                            <p class="text-sm text-gray-500 mb-3">Phản hồi của bạn giúp chúng tôi cải thiện độ chính xác của hệ thống</p>
                            
                            <div class="flex flex-wrap gap-3">
                                <button data-feedback="accurate" class="feedback-btn bg-green-100 text-green-800 hover:bg-green-200">
                                    <i class="fas fa-check-circle mr-2"></i> Kết quả chính xác
                                </button>
                                <button data-feedback="inaccurate" class="feedback-btn bg-red-100 text-red-800 hover:bg-red-200">
                                    <i class="fas fa-times-circle mr-2"></i> Kết quả không chính xác
                                </button>
                                <button data-feedback="unsure" class="feedback-btn bg-yellow-100 text-yellow-800 hover:bg-yellow-200">
                                    <i class="fas fa-question-circle mr-2"></i> Không chắc chắn
                                </button>
                            </div>
                            
                            <div id="feedbackMessage" class="mt-3 text-sm hidden"></div>
                            
                            <div id="inaccurateFeedbackForm" class="mt-4 hidden">
                                <textarea id="feedbackDetails" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Vui lòng mô tả chi tiết vấn đề bạn gặp phải..."></textarea>
                                <button id="submitFeedbackBtn" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                                    Gửi phản hồi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="relatedChecks" class="mt-8 hidden">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Kiểm tra liên quan</h3>
                    <div class="grid md:grid-cols-2 gap-4" id="relatedChecksContainer">
                        </div>
                    <div id="noRelatedChecksMessage" class="p-4 text-center text-gray-500 hidden">
                        Không tìm thấy các kiểm tra liên quan.
                    </div>
                </div>
            </div>
            
            <div id="historySection" class="mt-12">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">Lịch sử kiểm tra</h2>
                    <button id="clearHistoryBtn" class="text-sm text-red-600 hover:text-red-800">
                        <i class="fas fa-trash-alt mr-1"></i> Xóa lịch sử
                    </button>
                </div>
                
                <div id="historyList" class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="divide-y divide-gray-200">
                        <div id="emptyHistoryMessage" class="p-6 text-center text-gray-500">
                            <i class="fas fa-history text-3xl mb-3"></i>
                            <p>Chưa có lịch sử kiểm tra nào</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <section class="bg-blue-50 py-12 mt-12">
        <div class="container mx-auto px-4">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-8">Cách nhận biết tin giả</h2>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="text-blue-600 mb-4">
                        <i class="fas fa-search fa-2x"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Kiểm tra nguồn tin</h3>
                    <p class="text-gray-600">Luôn xác minh thông tin từ các nguồn chính thống, đáng tin cậy. Cảnh giác với các trang web giả mạo.</p>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="text-blue-600 mb-4">
                        <i class="fas fa-calendar-check fa-2x"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Kiểm tra ngày tháng</h3>
                    <p class="text-gray-600">Tin giả thường sử dụng thông tin cũ, không còn phù hợp với bối cảnh hiện tại.</p>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="text-blue-600 mb-4">
                        <i class="fas fa-images fa-2x"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Kiểm tra hình ảnh</h3>
                    <p class="text-gray-600">Sử dụng công cụ tìm kiếm hình ảnh ngược để xác minh ảnh có bị chỉnh sửa hoặc dùng sai ngữ cảnh không.</p>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-900 text-white py-10 mt-auto">
        <div class="container bg-gray-900 mx-auto text-center px-4">
            <p class="text-lg mb-4">&copy; 2025 Kiểm Tin Thật. Phát triển bởi Nguyễn Võ Anh Khoa </p>
            <div class="flex justify-center space-x-6 mt-4">
                <a href="https://www.facebook.com/anhkhoavnk/?locale=vi_VN" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-400 transition duration-300 text-xl"><i class="fab fa-facebook-f "></i> Facebook</a>
               
            </div>
        </div>
    </footer>

    <div id="feedbackModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">Cảm ơn phản hồi của bạn!</h3>
                <button id="closeFeedbackModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p id="feedbackModalMessage" class="mb-4"></p>
            <button id="feedbackModalCloseBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                Đóng
            </button>
        </div>
    </div>

    <div id="toastContainer" class="toast-container"></div>

    <script>
        // Constants
        const LOCAL_STORAGE_KEY = 'kiemTinThatHistory';
        const MAX_HISTORY_ITEMS = 20;
        
        // DOM Elements
        const DOM = {
            // Tabs
            tabUrlBtn: document.getElementById('tabUrl'),
            tabTextBtn: document.getElementById('tabText'),
            urlTab: document.getElementById('url-tab'),
            textTab: document.getElementById('text-tab'),
            
            // Inputs
            urlInput: document.getElementById('urlInput'),
            textInput: document.getElementById('textInput'),
            submitUrlBtn: document.getElementById('submitUrlBtn'),
            submitTextBtn: document.getElementById('submitTextBtn'),
            urlError: document.getElementById('urlError'),
            textError: document.getElementById('textError'),
            
            // Results
            loadingIndicator: document.getElementById('loadingIndicator'),
            progressBar: document.getElementById('progressBar'), // New: Progress bar
            resultSection: document.getElementById('resultSection'),
            sourceIcon: document.getElementById('sourceIcon'),
            sourceType: document.getElementById('sourceType'),
            sourceContent: document.getElementById('sourceContent'),
            trustScoreCircle: document.getElementById('trustScoreCircle'),
            trustScoreText: document.getElementById('trustScoreText'),
            trustScoreBar: document.getElementById('trustScoreBar'),
            analysisDetails: document.getElementById('analysisDetails'),
            recommendationSection: document.getElementById('recommendationSection'),
            recommendationContent: document.getElementById('recommendationContent'),
            relatedChecks: document.getElementById('relatedChecks'),
            relatedChecksContainer: document.getElementById('relatedChecksContainer'),
            noRelatedChecksMessage: document.getElementById('noRelatedChecksMessage'),
            
            // Feedback
            feedbackBtns: document.querySelectorAll('.feedback-btn'),
            feedbackMessage: document.getElementById('feedbackMessage'),
            inaccurateFeedbackForm: document.getElementById('inaccurateFeedbackForm'),
            feedbackDetails: document.getElementById('feedbackDetails'),
            submitFeedbackBtn: document.getElementById('submitFeedbackBtn'),
            
            // History
            historyList: document.getElementById('historyList'),
            emptyHistoryMessage: document.getElementById('emptyHistoryMessage'),
            clearHistoryBtn: document.getElementById('clearHistoryBtn'),
            
            // Modals
            feedbackModal: document.getElementById('feedbackModal'),
            feedbackModalMessage: document.getElementById('feedbackModalMessage'),
            closeFeedbackModal: document.getElementById('closeFeedbackModal'),
            feedbackModalCloseBtn: document.getElementById('feedbackModalCloseBtn'),
            
            // Mobile menu
            mobileMenuButton: document.getElementById('mobile-menu-button'),
            mobileMenu: document.getElementById('mobile-menu'),

            // Toast
            toastContainer: document.getElementById('toastContainer')
        };

        // State
        let currentAnalysis = null;
        let currentInputType = 'url';
        let simulationProgressBarInterval = null; // For progress bar simulation

        // Initialize the app
        function init() {
            setupEventListeners();
            loadHistory();
            switchTab('url');
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Tab switching
            DOM.tabUrlBtn?.addEventListener('click', () => switchTab('url'));
            DOM.tabTextBtn?.addEventListener('click', () => switchTab('text'));
            
            // Form submission
            DOM.submitUrlBtn?.addEventListener('click', handleSubmit);
            DOM.submitTextBtn?.addEventListener('click', handleSubmit);
            
            // Feedback
            DOM.feedbackBtns.forEach(btn => {
                btn.addEventListener('click', handleFeedback);
            });
            DOM.submitFeedbackBtn?.addEventListener('click', submitDetailedFeedback);
            
            // History
            DOM.clearHistoryBtn?.addEventListener('click', clearHistory);
            
            // Modal
            DOM.closeFeedbackModal?.addEventListener('click', closeModal);
            DOM.feedbackModalCloseBtn?.addEventListener('click', closeModal);
            
            // Mobile menu
            DOM.mobileMenuButton?.addEventListener('click', toggleMobileMenu);
            
            // Allow submitting with Enter key
            DOM.urlInput?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent default form submission if any
                    handleSubmit();
                }
            });
            DOM.textInput?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { // Allow Shift+Enter for new line in textarea
                    e.preventDefault(); // Prevent default new line
                    handleSubmit();
                }
            });
        }
        
        // Switch between URL and text tabs
        function switchTab(type) {
            currentInputType = type;
            
            // Update tab buttons
            DOM.tabUrlBtn?.classList.remove('tab-active');
            DOM.tabTextBtn?.classList.remove('tab-active');
            
            // Hide all tab contents
            DOM.urlTab?.classList.add('hidden');
            DOM.textTab?.classList.add('hidden');
            
            // Activate selected tab
            if (type === 'url') {
                DOM.tabUrlBtn?.classList.add('tab-active');
                DOM.urlTab?.classList.remove('hidden');
                DOM.urlInput?.focus();
            } else {
                DOM.tabTextBtn?.classList.add('tab-active');
                DOM.textTab?.classList.remove('hidden');
                DOM.textInput?.focus();
            }
            
            // Clear any existing errors
            DOM.urlError?.classList.add('hidden');
            DOM.textError?.classList.add('hidden');
        }
        
        // Handle form submission
        async function handleSubmit() {
            let inputValue, errorElement;
            
            if (currentInputType === 'url') {
                inputValue = DOM.urlInput?.value.trim();
                errorElement = DOM.urlError;
            } else {
                inputValue = DOM.textInput?.value.trim();
                errorElement = DOM.textError;
            }
            
            // Validate input
            if (!inputValue) {
                showError(errorElement, currentInputType === 'url' 
                    ? 'Vui lòng nhập URL bài viết.' 
                    : 'Vui lòng nhập nội dung cần kiểm tra.');
                return;
            }
            
            if (currentInputType === 'url') {
                try {
                    new URL(inputValue); // Validate URL format
                } catch (e) {
                    showError(errorElement, 'URL không hợp lệ. Vui lòng nhập URL đầy đủ (ví dụ: https://example.com).');
                    return;
                }
            } else if (inputValue.length < 20) {
                showError(errorElement, 'Nội dung quá ngắn (ít nhất 20 ký tự).');
                return;
            }
            
            // Clear errors
            errorElement?.classList.add('hidden');
            
            // Show loading indicator
            DOM.loadingIndicator?.classList.remove('hidden');
            DOM.resultSection?.classList.add('hidden');
            startProgressBar(); // Start progress bar animation
            
            try {
                // Analyze the content
                currentAnalysis = await analyzeContent(currentInputType, inputValue);
                
                // Save to history
                saveToHistory({
                    type: currentInputType,
                    content: inputValue,
                    analysis: currentAnalysis.analysis, // Save only the analysis part
                    timestamp: new Date().getTime()
                });
                
                // Display results
                displayResults();
            } catch (error) {
                console.error('Analysis error:', error);
                showError(errorElement, error.message || 'Đã xảy ra lỗi khi phân tích. Vui lòng thử lại.');
            } finally {
                DOM.loadingIndicator?.classList.add('hidden');
                stopProgressBar(); // Stop progress bar animation
            }
        }

        // Simulate progress bar
        function startProgressBar() {
            let width = 0;
            DOM.progressBar.style.width = '0%';
            clearInterval(simulationProgressBarInterval); // Clear any existing interval

            simulationProgressBarInterval = setInterval(() => {
                if (width < 90) { // Simulate progress up to 90%
                    width += Math.random() * 5; // Random increment
                    DOM.progressBar.style.width = `${Math.min(90, width)}%`;
                }
            }, 200);
        }

        function stopProgressBar() {
            clearInterval(simulationProgressBarInterval);
            DOM.progressBar.style.width = '100%'; // Complete the bar
            setTimeout(() => {
                DOM.progressBar.style.width = '0%'; // Reset for next use
            }, 500); // Give a slight delay before resetting
        }
        
        // Display analysis results
        function displayResults() {
            if (!currentAnalysis) return;
            
            // Set source information
            if (currentInputType === 'url') {
                DOM.sourceIcon.className = 'fas fa-link text-blue-600';
                DOM.sourceType.textContent = 'URL bài viết';
                DOM.sourceContent.innerHTML = `<a href="${currentAnalysis.content}" target="_blank" rel="noopener">${currentAnalysis.content}</a>`;
            } else {
                DOM.sourceIcon.className = 'fas fa-align-left text-blue-600';
                DOM.sourceType.textContent = 'Nội dung văn bản';
                DOM.sourceContent.textContent = currentAnalysis.content && currentAnalysis.content.length > 100 
                    ? currentAnalysis.content.substring(0, 100) + '...' 
                    : (currentAnalysis.content || 'Nội dung trống');
            }
            
            // Set trust score
            const score = currentAnalysis.analysis?.score ?? 0;
            DOM.trustScoreCircle.textContent = `${score}%`;
            DOM.trustScoreBar.style.width = `${score}%`;
            
            // Update score color and text
            let scoreColorClass, scoreText;
            if (score >= 70) {
                scoreColorClass = 'bg-green-500';
                scoreText = 'Cao';
            } else if (score >= 40) {
                scoreColorClass = 'bg-yellow-500';
                scoreText = 'Trung bình';
            } else {
                scoreColorClass = 'bg-red-500';
                scoreText = 'Thấp';
            }
            DOM.trustScoreCircle.className = `h-16 w-16 rounded-full flex items-center justify-center text-white font-bold text-xl ${scoreColorClass}`;
            DOM.trustScoreText.textContent = scoreText;
            
            // Set analysis details
            DOM.analysisDetails.innerHTML = '';
            const reasons = currentAnalysis.analysis?.reasons || ['Không có phân tích chi tiết.'];
            reasons.forEach(reason => {
                const div = document.createElement('div');
                div.className = 'flex items-start';
                div.innerHTML = `
                    <div class="flex-shrink-0 mt-1">
                        <i class="fas fa-info-circle text-blue-500"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-gray-700">${reason}</p>
                    </div>
                `;
                DOM.analysisDetails.appendChild(div);
            });
            
            // Set recommendation
            let recommendationHtml, recColorClass;
            if (score >= 70) {
                recommendationHtml = `
                    <p class="font-bold text-green-700 mb-2"><i class="fas fa-check-circle mr-2"></i>Thông tin có vẻ đáng tin cậy</p>
                    <p class="text-sm">Nội dung này có nhiều dấu hiệu đáng tin cậy. Tuy nhiên, luôn kiểm tra từ nhiều nguồn trước khi chia sẻ.</p>
                `;
                recColorClass = 'bg-green-100 border-green-300 text-green-700';
            } else if (score >= 40) {
                recommendationHtml = `
                    <p class="font-bold text-yellow-700 mb-2"><i class="fas fa-exclamation-triangle mr-2"></i>Cần thận trọng với thông tin này</p>
                    <p class="text-sm">Nội dung này có một số dấu hiệu không rõ ràng. Bạn nên kiểm tra từ các nguồn chính thống trước khi tin tưởng hoặc chia sẻ.</p>
                `;
                recColorClass = 'bg-yellow-100 border-yellow-300 text-yellow-700';
            } else {
                recommendationHtml = `
                    <p class="font-bold text-red-700 mb-2"><i class="fas fa-times-circle mr-2"></i>Thông tin không đáng tin cậy</p>
                    <p class="text-sm">Nội dung này có nhiều dấu hiệu của tin giả hoặc thông tin sai lệch. Không nên chia sẻ mà không kiểm chứng từ các nguồn uy tín.</p>
                `;
                recColorClass = 'bg-red-100 border-red-300 text-red-700';
            }
            
            DOM.recommendationSection.className = `p-4 rounded-lg border ${recColorClass}`;
            DOM.recommendationContent.innerHTML = recommendationHtml;
            
            // Show related checks if available
            const relatedChecksData = currentAnalysis.analysis?.relatedChecks || [];
            DOM.relatedChecksContainer.innerHTML = ''; // Clear previous checks
            DOM.relatedChecks.classList.add('hidden'); // Hide by default
            DOM.noRelatedChecksMessage.classList.add('hidden'); // Hide message by default

            if (relatedChecksData.length > 0) {
                DOM.relatedChecks.classList.remove('hidden');
                relatedChecksData.forEach(check => {
                    const checkElement = document.createElement('div');
                    checkElement.className = 'bg-white p-4 rounded-lg shadow-sm border border-gray-200';
                    checkElement.innerHTML = `
                        <h4 class="font-medium text-gray-800 mb-2">${check.title || 'Tiêu đề không rõ'}</h4>
                        <div class="flex justify-between text-sm text-gray-500 mb-2">
                            <span>${check.date || 'Ngày không rõ'}</span>
                            <span class="font-medium ${check.rating === 'Sai lệch' ? 'text-red-600' : 'text-green-600'}">${check.rating || 'Không rõ'}</span>
                        </div>
                        <a href="${check.url || '#'}" class="text-sm text-blue-600 hover:underline" target="_blank" rel="noopener">Xem chi tiết</a>
                    `;
                    DOM.relatedChecksContainer.appendChild(checkElement);
                });
            } else {
                DOM.relatedChecks.classList.remove('hidden'); // Show section but with no results message
                DOM.noRelatedChecksMessage.classList.remove('hidden');
            }

            // Show results section
            DOM.resultSection.classList.remove('hidden');

            // Reset feedback section
            DOM.feedbackMessage.classList.add('hidden');
            DOM.inaccurateFeedbackForm.classList.add('hidden');
            DOM.feedbackDetails.value = '';
            DOM.feedbackBtns.forEach(btn => btn.classList.remove('bg-blue-200', 'text-blue-900'));
        }

        // Simulate AI analysis - IMPROVED LOGIC FOR GRADING
        async function analyzeContent(type, content) {
            return new Promise(resolve => {
                setTimeout(() => {
                    let score, reasons, relatedChecks;
                    const lowerContent = content.toLowerCase();
                    const currentYear = new Date().getFullYear();

                    // Function to check for keywords
                    const containsAny = (text, keywords) => keywords.some(keyword => text.includes(keyword));

                    // Define keyword sets
                    const keywordsHighlyFake = ['tin giả', 'nghe nói', 'sốc', 'vỡ lở', 'chấn động', 'độc quyền và không thể kiểm chứng', 'thuyết âm mưu', 'khủng khiếp', 'chết chóc', 'bí mật chưa từng tiết lộ'];
                    const keywordsModeratelyFake = ['tin đồn', 'chưa xác minh', 'khả năng', 'nghi vấn', 'theo một số nguồn tin', 'không chính thức', 'chưa được công bố', 'rò rỉ thông tin'];
                    const keywordsTrustworthy = ['bộ y tế', 'chính phủ', 'chính thức', 'theo công bố', 'nghiên cứu khoa học', 'báo cáo từ', 'thông cáo báo chí', 'được xác nhận bởi', 'tổ chức uy tín'];
                    const keywordsNeutral = ['nhân vật', 'sự kiện', 'phát biểu', 'tình hình', 'kinh tế', 'xã hội', 'việt nam']; // Generic words, added 'viet nam'

                    // --- Logic for varying scores ---

                    // 1. Prioritize highly fake indicators
                    if (containsAny(lowerContent, keywordsHighlyFake)) {
                        score = Math.floor(Math.random() * 20) + 10; // 10-29%
                        reasons = [
                            'Nội dung có dấu hiệu giật gân, thiếu căn cứ hoặc nguồn không rõ ràng.',
                            'Sử dụng ngôn ngữ cảm xúc mạnh, có thể nhằm mục đích gây hoang mang hoặc kích động.',
                            'Thông tin có thể đã bị bác bỏ hoặc không có bằng chứng xác thực.',
                            'Thiếu các chi tiết cụ thể hoặc thông tin kiểm chứng.'
                        ];
                        } 
                    // 2. Then check for moderately fake indicators
                    else if (containsAny(lowerContent, keywordsModeratelyFake)) {
                        score = Math.floor(Math.random() * 30) + 30; // 30-59%
                        reasons = [
                            'Nội dung mang tính suy đoán, chưa được kiểm chứng chính thức.',
                            'Thông tin có thể bị thiếu ngữ cảnh hoặc chưa đầy đủ.',
                            'Cần tìm kiếm các nguồn tin uy tín khác để đối chiếu.',
                            'Nguồn tin không phải là nguồn chính thống hoặc ít được biết đến.'
                        ];
                        relatedChecks = [
                            {
                                title: 'Nghi vấn về dự án phát triển mới',
                                date: `15/04/${currentYear}`,
                                rating: 'Chưa kiểm chứng',
                                url: 'https://example.com/project-rumors'
                            }
                        ];
                    } 
                
                    // 4. Fallback for neutral or unclear content
                    else if (containsAny(lowerContent, keywordsNeutral) || content.length < 50) {
                        score = Math.floor(Math.random() * 20) + 50; // 50-69%
                        reasons = [
                            'Nội dung không có dấu hiệu rõ ràng của tin giả, nhưng cũng thiếu các yếu tố xác thực mạnh mẽ.',
                            'Có thể là thông tin chung chung hoặc không đủ chi tiết để đánh giá toàn diện.',
                            'Độ dài văn bản ngắn có thể không cung cấp đủ ngữ cảnh.'
                        ];
                        relatedChecks = [];
                    }
                    // 5. Default high score if no strong indicators
                    else {
                        score = Math.floor(Math.random() * 10) + 85; // 85-94%
                        reasons = [
                            'Nội dung có vẻ hợp lý và không chứa các yếu tố cảnh báo về tin giả.',
                            'Cấu trúc câu rõ ràng, không giật gân.'
                        ];
                        relatedChecks = []; 
                    }
                    
                    // Add a slight random variance to the score
                    score = Math.max(10, Math.min(95, score + Math.floor(Math.random() * 10) - 5)); // Keep score between 10-95

                    resolve({
                        type: type,
                        content: content,
                        analysis: {
                            score: score,
                            reasons: reasons,
                            relatedChecks: relatedChecks
                        }
                    });
                }, 2000); // Simulate network delay
            });
        }

        // Handle user feedback
        function handleFeedback(event) {
            const feedbackType = event.currentTarget.dataset.feedback;

            // Remove active class from all buttons
            DOM.feedbackBtns.forEach(btn => btn.classList.remove('bg-blue-200', 'text-blue-900'));
            // Add active class to the clicked button
            event.currentTarget.classList.add('bg-blue-200', 'text-blue-900');

            DOM.feedbackMessage.classList.remove('hidden');
            DOM.inaccurateFeedbackForm.classList.add('hidden'); // Hide by default

            if (feedbackType === 'accurate') {
                DOM.feedbackMessage.textContent = 'Cảm ơn bạn đã xác nhận! Phản hồi của bạn giúp chúng tôi cải thiện hệ thống.';
                showToast('Cảm ơn phản hồi của bạn!', 'success');
            } else if (feedbackType === 'inaccurate') {
                DOM.feedbackMessage.textContent = 'Xin lỗi vì kết quả không chính xác. Vui lòng cung cấp thêm chi tiết để chúng tôi cải thiện.';
                DOM.inaccurateFeedbackForm.classList.remove('hidden');
            } else if (feedbackType === 'unsure') {
                DOM.feedbackMessage.textContent = 'Chúng tôi sẽ ghi nhận sự không chắc chắn của bạn. Bạn có thể cung cấp thêm chi tiết nếu muốn.';
                showToast('Phản hồi của bạn đã được ghi nhận!', 'info');
            }
        }

        // Submit detailed feedback for inaccurate results
        function submitDetailedFeedback() {
            const details = DOM.feedbackDetails?.value.trim();
            if (!details) {
                showToast('Vui lòng nhập chi tiết phản hồi.', 'warning');
                return;
            }
            console.log('Detailed feedback:', details);
            showToast('Phản hồi chi tiết của bạn đã được gửi. Chúng tôi sẽ xem xét.', 'success');
            DOM.inaccurateFeedbackForm?.classList.add('hidden');
            DOM.feedbackMessage?.classList.add('hidden');
            DOM.feedbackDetails.value = ''; // Clear textarea
            DOM.feedbackBtns.forEach(btn => btn.classList.remove('bg-blue-200', 'text-blue-900')); // Reset button state
        }

        // Close the modal
        function closeModal() {
            DOM.feedbackModal?.classList.add('hidden');
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast`;
            toast.textContent = message;
            
            // Add type-specific styling
            if (type === 'success') toast.style.backgroundColor = '#059669'; // success-color
            else if (type === 'error') toast.style.backgroundColor = '#dc2626'; // danger-color
            else if (type === 'warning') toast.style.backgroundColor = '#d97706'; // warning-color
            else toast.style.backgroundColor = '#333'; // default info

            DOM.toastContainer.appendChild(toast);
            
            // Show animation
            setTimeout(() => {
                toast.classList.add('show');
            }, 10); // Small delay to trigger transition

            // Hide and remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 3000);
        }

        // Load history from local storage
        function loadHistory() {
            try {
                const history = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || '[]');
                displayHistory(history);
            } catch (e) {
                console.error("Error loading history from localStorage:", e);
                // Clear corrupted history if parsing fails
                localStorage.removeItem(LOCAL_STORAGE_KEY);
                displayHistory([]);
                showToast('Lịch sử đã bị hỏng và được xóa. Vui lòng thử lại.', 'error');
            }
        }

        // Save analysis to history in local storage
        function saveToHistory(item) {
            let history = [];
            try {
                history = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || '[]');
            } catch (e) {
                console.error("Error parsing history from localStorage, clearing it:", e);
                history = []; // Clear history if it's corrupted
            }
            
            history.unshift(item); // Add to the beginning
            // Keep only the latest MAX_HISTORY_ITEMS
            if (history.length > MAX_HISTORY_ITEMS) {
                history.splice(MAX_HISTORY_ITEMS);
            }
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(history));
            displayHistory(history); // Update displayed history
        }

        // Display history items
        function displayHistory(history) {
            DOM.historyList.innerHTML = ''; // Clear current history
            if (history.length === 0) {
                DOM.historyList.appendChild(DOM.emptyHistoryMessage);
                DOM.emptyHistoryMessage?.classList.remove('hidden');
            } else {
                DOM.emptyHistoryMessage?.classList.add('hidden');
                history.forEach(item => {
                    // Ensure content and analysis exist before accessing their properties
                    const contentDisplay = item.content && item.content.length > 70 
                        ? item.content.substring(0, 70) + '...' 
                        : (item.content || 'Nội dung trống'); 
                    
                    const score = item.analysis?.score ?? 0;
                    const scoreColor = getScoreColorCode(score);
                    const scoreText = getScoreText(score);

                    const historyItem = document.createElement('div');
                    historyItem.className = 'p-4 hover:bg-gray-50 cursor-pointer flex justify-between items-center';
                    historyItem.innerHTML = `
                        <div>
                            <p class="font-medium text-gray-800">${item.type === 'url' ? 'URL: ' : 'Văn bản: '}
                                <span class="text-blue-600">${contentDisplay}</span>
                            </p>
                            <p class="text-sm text-gray-500">
                                Đánh giá: <span class="font-semibold" style="color: ${scoreColor};">${score}% - ${scoreText}</span>
                                <span class="ml-4">${item.timestamp ? new Date(item.timestamp).toLocaleString('vi-VN') : 'Không rõ ngày'}</span>
                            </p>
                        </div>
                        <button class="text-gray-400 hover:text-red-500 delete-history-item" data-timestamp="${item.timestamp}">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    DOM.historyList?.appendChild(historyItem);
                });

                // Add event listeners to delete buttons
                DOM.historyList?.querySelectorAll('.delete-history-item').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent item click from triggering
                        const timestampToDelete = parseInt(e.currentTarget.dataset.timestamp);
                        deleteHistoryItem(timestampToDelete);
                    });
                });

                // Add event listener to click on history item to re-display
                DOM.historyList?.querySelectorAll('.p-4.hover\\:bg-gray-50').forEach(itemElement => {
                    itemElement.addEventListener('click', (e) => {
                        // Find the corresponding item in history array
                        const timestamp = parseInt(e.currentTarget.querySelector('.delete-history-item').dataset.timestamp);
                        const history = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || '[]');
                        const clickedItem = history.find(h => h.timestamp === timestamp);
                        if (clickedItem) {
                            currentAnalysis = {
                                type: clickedItem.type,
                                content: clickedItem.content,
                                analysis: clickedItem.analysis
                            };
                            currentInputType = clickedItem.type;
                            if (currentInputType === 'url') {
                                DOM.urlInput.value = clickedItem.content;
                                DOM.textInput.value = '';
                            } else {
                                DOM.textInput.value = clickedItem.content;
                                DOM.urlInput.value = '';
                            }
                            switchTab(currentInputType);
                            displayResults();
                            window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top to show results
                        }
                    });
                });
            }
        }

        // Delete a single history item
        function deleteHistoryItem(timestamp) {
            let history = [];
            try {
                history = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || '[]');
            } catch (e) {
                console.error("Error parsing history from localStorage, clearing it:", e);
                history = []; // Clear history if it's corrupted
            }
            history = history.filter(item => item.timestamp !== timestamp);
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(history));
            displayHistory(history);
            showToast('Đã xóa mục khỏi lịch sử.', 'info');
        }

        // Clear all history
        function clearHistory() {
            if (confirm('Bạn có chắc chắn muốn xóa toàn bộ lịch sử kiểm tra?')) {
                localStorage.removeItem(LOCAL_STORAGE_KEY);
                displayHistory([]);
                showToast('Đã xóa toàn bộ lịch sử.', 'info');
            }
        }

        // Helper function to get score color code
        function getScoreColorCode(score) {
            if (score >= 70) return '#059669'; // success-color
            if (score >= 40) return '#d97706'; // warning-color
            return '#dc2626'; // danger-color
        }

        // Helper function to get score text
        function getScoreText(score) {
            if (score >= 70) return 'Cao';
            if (score >= 40) return 'Trung bình';
            return 'Thấp';
        }

        // Show error message
        function showError(element, message) {
            if (element) {
                element.textContent = message;
                element.classList.remove('hidden');
            }
        }

        // Toggle mobile menu visibility
        function toggleMobileMenu() {
            DOM.mobileMenu?.classList.toggle('hidden');
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>