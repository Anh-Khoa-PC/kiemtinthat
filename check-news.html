<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·ªÉm Tin Th·∫≠t - Ki·ªÉm Tin T·ª©c (AI N√¢ng C·∫•p)</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="logo.png">
    <style>
        /* Base Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; /* N·ªÅn m√†u tr·∫Øng */
        }

        /* Utility Classes (if not fully covered by Tailwind or for custom behaviors) */
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
            cursor: pointer;
            display: inline-flex; /* S·ª≠ d·ª•ng flex ƒë·ªÉ cƒÉn ch·ªânh bi·ªÉu t∆∞·ª£ng */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Kho·∫£ng c√°ch gi·ªØa ch·ªØ v√† bi·ªÉu t∆∞·ª£ng */
        }
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        .btn-primary {
            background-color: #1d4ed8; /* Xanh d∆∞∆°ng ƒë·∫≠m */
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #1e40af; /* Xanh d∆∞∆°ng ƒë·∫≠m h∆°n */
        }
        .btn-secondary {
            background-color: #e5e7eb; /* X√°m nh·∫°t */
            color: #374151; /* X√°m ƒë·∫≠m */
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: #d1d5db; /* X√°m trung b√¨nh */
        }

        /* Form Elements */
        .input-field, .textarea-field {
            border-radius: 8px;
            border: 1px solid #d1d5db; /* X√°m trung b√¨nh */
            padding: 0.75rem 1rem;
            width: 100%;
            box-sizing: border-box; /* ƒê·∫£m b·∫£o padding kh√¥ng l√†m tƒÉng chi·ªÅu r·ªông */
        }
        .input-field:focus, .textarea-field:focus {
            outline: none;
            border-color: #1d4ed8; /* Xanh d∆∞∆°ng ƒë·∫≠m */
            box-shadow: 0 0 0 2px rgba(29, 78, 216, 0.3); /* Xanh d∆∞∆°ng ƒë·∫≠m v·ªõi ƒë·ªô m·ªù */
        }
        .textarea-field {
            min-height: 120px;
            resize: vertical;
        }

        /* History Items */
        .history-item {
            border: 1px solid #e5e7eb; /* X√°m nh·∫°t */
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            background-color: #f9fafb; /* X√°m r·∫•t nh·∫°t */
        }

        /* Score Badges */
        .score-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 16px;
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            display: inline-block;
        }
        .score-real { background-color: #dcfce7; color: #166534; } /* Xanh l√° c√¢y nh·∫°t / Xanh l√° c√¢y ƒë·∫≠m */
        .score-fake { background-color: #fee2e2; color: #991b1b; } /* ƒê·ªè nh·∫°t / ƒê·ªè ƒë·∫≠m */
        .score-mid { background-color: #fef3c7; color: #92400e; } /* V√†ng nh·∫°t / V√†ng ƒë·∫≠m */

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5); /* N·ªÅn m·ªù */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 500px;
            text-align: center;
            transform: translateY(-20px); /* Tr·∫°ng th√°i ban ƒë·∫ßu cho animation */
            transition: transform 0.3s ease;
        }
        .modal.active .modal-content {
            transform: translateY(0);
        }

        /* Loader */
        .loader {
            border: 4px solid #f3f3f3; /* X√°m nh·∫°t */
            border-top: 4px solid #1d4ed8; /* Xanh d∆∞∆°ng ƒë·∫≠m */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tabs */
        .tabs button {
            padding: 0.5rem 1rem;
            border-radius: 6px 6px 0 0;
            background-color: #e5e7eb; /* X√°m nh·∫°t */
            color: #374151; /* X√°m ƒë·∫≠m */
            font-weight: 500;
            border: 1px solid #d1d5db; /* X√°m trung b√¨nh */
            border-bottom: none;
            margin-right: -1px; /* Tr√πng bi√™n ƒë·ªÉ li·ªÅn m·∫°ch */
        }
        .tabs button.active {
            background-color: white;
            color: #1d4ed8; /* Xanh d∆∞∆°ng ƒë·∫≠m */
            border-bottom: 1px solid white; /* ·∫®n bi√™n d∆∞·ªõi c·ªßa tab ƒëang ho·∫°t ƒë·ªông */
            position: relative;
            z-index: 1;
        }
        .tab-content {
            border: 1px solid #d1d5db; /* X√°m trung b√¨nh */
            padding: 1.5rem;
            border-radius: 0 8px 8px 8px;
            margin-top: -1px; /* Tr√πng bi√™n v·ªõi tab */
            background-color: white;
        }
    </style>
</head>
<body class="bg-white flex flex-col min-h-screen">
    <header class=" py-5 sticky top-0 z-50">
        <nav class="container mx-auto flex justify-between items-center px-6 lg:px-8">
            <a href="index.html" class="text-3xl font-extrabold text-blue-700 tracking-tight" aria-label="Trang ch·ªß Ki·ªÉm Tin Th·∫≠t">Ki·ªÉm Tin Th·∫≠t</a>
            <div class=" md:flex space-x-8">
                <a href="index.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Trang ch·ªß</a>
                <a href="check-news.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">Ki·ªÉm tra tin gi·∫£</a>
                <a href="reports.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">B√°o C√°o</a>
                <a href="about-us.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">V·ªÅ ch√∫ng t√¥i</a>
                <a href="contribute.html" class="text-gray-700 hover:text-blue-600 font-semibold text-lg transition duration-300 ease-in-out transform hover:scale-105">ƒê√≥ng g√≥p / ·ª¶ng h·ªô</a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-700 focus:outline-none p-2 rounded-md hover:bg-gray-100 transition duration-200" aria-label="M·ªü menu di ƒë·ªông">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-white mt-3 py-3 shadow-lg rounded-xl mx-4">
            <a href="index.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">Trang ch·ªß</a>
            <a href="check-news.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">Ki·ªÉm tra tin gi·∫£</a>
            <a href="reports.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">B√°o C√°o</a>
            <a href="about-us.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">V·ªÅ ch√∫ng t√¥i</a>
            <a href="contribute.html" class="block px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition duration-200 text-lg font-medium">ƒê√≥ng g√≥p / ·ª¶ng h·ªô</a>
        </div>
    </header>

    <main class="flex-grow">
        <div class="container">
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold text-blue-700">Ki·ªÉm Tin Th·∫≠t</h1>
                <p class="text-lg text-gray-600 mt-2">C√¥ng c·ª• ki·ªÉm tra t√≠nh x√°c th·ª±c c·ªßa tin t·ª©c v·ªõi AI</p>
            </header>

            <section id="inputMethodSection" class="mb-8">
                <div role="tablist" class="tabs flex border-b border-gray-300">
                    <button role="tab" id="tabUrl" class="btn-tab active" data-tab="urlInputTab" aria-selected="true" aria-controls="urlInputTab">Ki·ªÉm tra Link</button>
                    <button role="tab" id="tabText" class="btn-tab" data-tab="textInputTab" aria-selected="false" aria-controls="textInputTab">Ki·ªÉm tra VƒÉn b·∫£n</button>
                </div>

                <div id="urlInputTab" role="tabpanel" aria-labelledby="tabUrl" class="tab-content">
                    <h2 class="text-xl font-semibold mb-3 text-gray-700">Nh·∫≠p link b√†i vi·∫øt</h2>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <input type="url" id="urlInput" class="input-field flex-grow" placeholder="https://example.com/news-article" aria-label="Nh·∫≠p URL b√†i vi·∫øt">
                    </div>
                    <div id="urlInputError" class="text-red-500 text-sm mt-2" aria-live="polite"></div>
                </div>

                <div id="textInputTab" role="tabpanel" aria-labelledby="tabText" class="tab-content hidden">
                    <h2 class="text-xl font-semibold mb-3 text-gray-700">Nh·∫≠p n·ªôi dung vƒÉn b·∫£n</h2>
                    <textarea id="textInput" class="textarea-field" placeholder="D√°n n·ªôi dung tin t·ª©c v√†o ƒë√¢y..." aria-label="Nh·∫≠p n·ªôi dung vƒÉn b·∫£n"></textarea>
                    <div id="textInputError" class="text-red-500 text-sm mt-2" aria-live="polite"></div>
                </div>
                <button id="submitBtn" class="btn btn-primary w-full mt-4" aria-label="Ki·ªÉm tra tin t·ª©c">
                    <i class="fas fa-search"></i> Ki·ªÉm Tra Tin
                </button>
            </section>

            <div id="loadingIndicator" class="text-center my-6 hidden" aria-live="assertive" aria-atomic="true">
                <div class="loader" role="status" aria-label="ƒêang t·∫£i"></div>
                <p class="text-gray-600">ƒêang ph√¢n t√≠ch b·∫±ng AI, vui l√≤ng ƒë·ª£i...</p>
            </div>

            <section id="resultSection" class="mb-8 p-6 bg-white rounded-lg shadow-md hidden" aria-live="polite">
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">K·∫øt Qu·∫£ Ph√¢n T√≠ch</h2>
                <div id="analysisResult" class="mb-4 space-y-2">
                    <p><strong>Ngu·ªìn ki·ªÉm tra:</strong> <span id="inputTypeDisplay" class="font-medium"></span></p>
                    <p><strong>N·ªôi dung:</strong> <span id="resultInput" class="text-blue-600 break-all"></span></p>
                    <p><strong>ƒêi·ªÉm Tin C·∫≠y (AI):</strong> <span id="truthScore" class="score-badge"></span></p>
                    <div id="recommendation" class="mt-4 p-3 border border-gray-200 rounded-lg hidden" role="alert"></div>
                    <div class="mt-3">
                        <h4 class="font-semibold text-gray-700">Gi·∫£i Th√≠ch Chi Ti·∫øt (t·ª´ AI):</h4>
                        <ul id="explanationList" class="list-disc list-inside text-gray-700 text-sm space-y-1 mt-1">
                            <li class="text-gray-500">Th√¥ng tin chi ti·∫øt s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y sau khi ph√¢n t√≠ch.</li>
                        </ul>
                    </div>
                </div>
                <div id="votingSection" class="mt-6 border-t border-gray-200 pt-6">
                    <h3 class="text-lg font-medium mb-3 text-gray-700">B·∫°n nghƒ© sao v·ªÅ k·∫øt qu·∫£ n√†y?</h3>
                    <div class="flex flex-wrap gap-3">
                        <button data-vote="real" class="btn btn-secondary vote-btn" aria-label="B√¨nh ch·ªçn tin th·∫≠t"><i class="far fa-thumbs-up"></i> Tin Th·∫≠t</button>
                        <button data-vote="fake" class="btn btn-secondary vote-btn" aria-label="B√¨nh ch·ªçn tin gi·∫£"><i class="far fa-thumbs-down"></i> Tin Gi·∫£</button>
                        <button data-vote="unsure" class="btn btn-secondary vote-btn" aria-label="B√¨nh ch·ªçn kh√¥ng ch·∫Øc"><i class="far fa-question-circle"></i> Kh√¥ng Ch·∫Øc</button>
                    </div>
                    <p id="voteMessage" class="text-sm text-green-600 mt-2" aria-live="polite"></p>
                </div>
            </section>

            <section id="historySection" class="p-6 bg-white rounded-lg shadow-md mt-8">
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">L·ªãch S·ª≠ Ki·ªÉm Tra</h2>
                <div id="historyList" class="space-y-3">
                    <p id="noHistoryMessage" class="text-gray-500">Ch∆∞a c√≥ m·ª•c n√†o ƒë∆∞·ª£c ki·ªÉm tra.</p>
                </div>
            </section>
        </div>
    </main>

    <div id="messageModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalMessageText">
        <div class="modal-content">
            <p id="modalMessageText" class="text-lg mb-4 text-gray-800"></p>
            <button id="modalCloseBtn" class="btn btn-primary">ƒê√≥ng</button>
        </div>
    </div>

    <footer class="bg-gray-900 text-white py-8 mt-auto">
        <div class="bg-gray-900 container mx-auto text-center px-10">
            <p class="text-md mb-5">&copy; 2025 Ki·ªÉm Tin Th·∫≠t. Ph√°t tri·ªÉn b·ªüi Nguy·ªÖn V√µ Anh Khoa ƒë·∫πp trai.</p>
            <div class="flex justify-center space-x-6">
                <a href="https://www.facebook.com/anhkhoavnk/?locale=vi_VN" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-400 transition duration-300 text-xl" aria-label="Facebook c√° nh√¢n c·ªßa Nguy·ªÖn V√µ Anh Khoa"><i class="fab fa-facebook-f"></i></a>
            </div>
        </div>
    </footer>

    <script type="module">
        // --- H·∫±ng s·ªë & C√°c ph·∫ßn t·ª≠ DOM ---
        const LOCAL_STORAGE_KEY = 'kiemTinThatHistory'; // Kh√≥a l∆∞u tr·ªØ l·ªãch s·ª≠ trong Local Storage
        let currentCheckedItem = null; // M·ª•c ƒëang ƒë∆∞·ª£c ki·ªÉm tra hi·ªán t·∫°i
        let currentInputType = 'url'; // Lo·∫°i ƒë·∫ßu v√†o hi·ªán t·∫°i: 'url' ho·∫∑c 'text'
        let debounceTimeout; // Bi·∫øn cho ch·ª©c nƒÉng debounce

        // URL c·ªßa d·ªãch v·ª• Chutes AI (proxy cho DeepSeek ho·∫∑c c√°c LLM kh√°c)
        const CHUTES_AI_API_URL = "https://llm.chutes.ai/v1/chat/completions";

        // API Token c·ªßa b·∫°n t·ª´ d·ªãch v·ª• Chutes AI.
        // B·∫°n c·∫ßn ƒëƒÉng k√Ω t√†i kho·∫£n t·∫°i Chutes AI v√† l·∫•y token n√†y.
        // TUY·ªÜT ƒê·ªêI KH√îNG ƒê·∫∂T API KEY C·ª¶A DEEPSEEK TR·ª∞C TI·∫æP V√ÄO ƒê√ÇY!
        // ƒê√¢y l√† token ƒë·ªÉ x√°c th·ª±c v·ªõi Chutes AI, kh√¥ng ph·∫£i key c·ªßa DeepSeek.
        // Token n√†y s·∫Ω ƒë∆∞·ª£c Netlify inject v√†o trong qu√° tr√¨nh build.
        const CHUTES_AI_API_TOKEN = "__CHUTES_AI_API_TOKEN__"; 
        // V√≠ d·ª•: const CHUTES_AI_API_TOKEN = "sk-your-chutes-ai-token-1234567890abcdef";


        const DOM = {
            // Tabs (C√°c tab chuy·ªÉn ƒë·ªïi lo·∫°i ƒë·∫ßu v√†o)
            tabUrlBtn: document.getElementById('tabUrl'),
            tabTextBtn: document.getElementById('tabText'),
            urlInputTab: document.getElementById('urlInputTab'),
            textInputTab: document.getElementById('textInputTab'),

            // Inputs (C√°c tr∆∞·ªùng nh·∫≠p li·ªáu)
            urlInput: document.getElementById('urlInput'),
            textInput: document.getElementById('textInput'),
            submitBtn: document.getElementById('submitBtn'),
            urlInputError: document.getElementById('urlInputError'),
            textInputError: document.getElementById('textInputError'),

            // Results & Loading (K·∫øt qu·∫£ v√† ch·ªâ b√°o t·∫£i)
            loadingIndicator: document.getElementById('loadingIndicator'),
            resultSection: document.getElementById('resultSection'),
            inputTypeDisplay: document.getElementById('inputTypeDisplay'),
            resultInput: document.getElementById('resultInput'),
            truthScore: document.getElementById('truthScore'),
            explanationList: document.getElementById('explanationList'),
            recommendationDiv: document.getElementById('recommendation'),

            // Voting (B√¨nh ch·ªçn)
            votingSection: document.getElementById('votingSection'),
            voteButtons: document.querySelectorAll('.vote-btn'),
            voteMessage: document.getElementById('voteMessage'),

            // History (L·ªãch s·ª≠)
            historyList: document.getElementById('historyList'),
            noHistoryMessage: document.getElementById('noHistoryMessage'),

            // Modal (H·ªôp tho·∫°i th√¥ng b√°o)
            messageModal: document.getElementById('messageModal'),
            modalMessageText: document.getElementById('modalMessageText'),
            modalCloseBtn: document.getElementById('modalCloseBtn'),

            // Mobile Menu (Menu di ƒë·ªông)
            mobileMenuButton: document.getElementById('mobile-menu-button'),
            mobileMenu: document.getElementById('mobile-menu')
        };

        // --- H√†m ti·ªán √≠ch ---
        function showMessageModal(message) {
            DOM.modalMessageText.textContent = message;
            DOM.messageModal.classList.add('active');
            DOM.modalCloseBtn.focus(); // T·∫≠p trung v√†o n√∫t ƒë√≥ng ƒë·ªÉ d·ªÖ truy c·∫≠p
        }

        function debounce(func, delay) {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(func, delay);
        }

        function scrollToElement(element) {
            if (element) {
                window.scrollTo({ top: element.offsetTop - 20, behavior: 'smooth' });
            }
        }

        // --- Logic chuy·ªÉn ƒë·ªïi tab ---
        function switchTab(tabType) {
            currentInputType = tabType;

            DOM.tabUrlBtn.classList.remove('active');
            DOM.tabUrlBtn.setAttribute('aria-selected', 'false');
            DOM.textInputTab.classList.add('hidden');

            DOM.tabTextBtn.classList.remove('active');
            DOM.tabTextBtn.setAttribute('aria-selected', 'false');
            DOM.urlInputTab.classList.add('hidden');

            // ƒê·∫∑t l·∫°i th√¥ng b√°o l·ªói
            DOM.urlInputError.textContent = "";
            DOM.textInputError.textContent = "";

            if (tabType === 'url') {
                DOM.tabUrlBtn.classList.add('active');
                DOM.tabUrlBtn.setAttribute('aria-selected', 'true');
                DOM.urlInputTab.classList.remove('hidden');
                DOM.urlInput.focus(); // T·∫≠p trung v√†o tr∆∞·ªùng nh·∫≠p li·ªáu ƒëang ho·∫°t ƒë·ªông
            } else {
                DOM.tabTextBtn.classList.add('active');
                DOM.tabTextBtn.setAttribute('aria-selected', 'true');
                DOM.textInputTab.classList.remove('hidden');
                DOM.textInput.focus(); // T·∫≠p trung v√†o tr∆∞·ªùng nh·∫≠p li·ªáu ƒëang ho·∫°t ƒë·ªông
            }
        }

        // --- Logic ph√¢n t√≠ch AI s·ª≠ d·ª•ng Chutes AI API ---
        async function callChutesAIAnalysis(type, inputValue) {
            // Prompt ƒë·ªÉ y√™u c·∫ßu AI ph√¢n t√≠ch v√† tr·∫£ v·ªÅ JSON
            let promptContent = `B·∫°n l√† m·ªôt chuy√™n gia ki·ªÉm tra tin t·ª©c. H√£y ph√¢n t√≠ch n·ªôi dung sau ƒë√¢y (c√≥ th·ªÉ l√† URL ho·∫∑c vƒÉn b·∫£n) v√† ƒë√°nh gi√° ƒë·ªô tin c·∫≠y c·ªßa n√≥ tr√™n thang ƒëi·ªÉm t·ª´ 0 ƒë·∫øn 100, trong ƒë√≥ 0 l√† ho√†n to√†n gi·∫£ m·∫°o v√† 100 l√† ho√†n to√†n ƒë√°ng tin c·∫≠y. ƒê·ªìng th·ªùi, h√£y cung c·∫•p m·ªôt danh s√°ch c√°c l√Ω do chi ti·∫øt (t·ªëi thi·ªÉu 3 l√Ω do) gi·∫£i th√≠ch cho ƒëi·ªÉm s·ªë ƒë√≥, t·∫≠p trung v√†o c√°c y·∫øu t·ªë nh∆∞ ngu·ªìn g·ªëc, ng√¥n ng·ªØ, t√≠nh h·ª£p l√Ω, v√† c√°c d·∫•u hi·ªáu c·ªßa tin gi·∫£/tin th·∫≠t.
N·ªôi dung c·∫ßn ph√¢n t√≠ch: ${inputValue}
ƒê·ªãnh d·∫°ng ph·∫£n h·ªìi JSON:
\`\`\`json
{
  "score": <s·ªë nguy√™n t·ª´ 0-100>,
  "reasons": [
    "<l√Ω do 1>",
    "<l√Ω do 2>",
    "<l√Ω do 3>",
    ...
  ]
}
\`\`\``;

            // Ki·ªÉm tra xem API Token c·ªßa Chutes AI ƒë√£ ƒë∆∞·ª£c cung c·∫•p ch∆∞a
            if (!CHUTES_AI_API_TOKEN || CHUTES_AI_API_TOKEN === "__CHUTES_AI_API_TOKEN__") {
                showMessageModal("L·ªói: API Token c·ªßa Chutes AI ch∆∞a ƒë∆∞·ª£c cung c·∫•p. Vui l√≤ng c·∫•u h√¨nh bi·∫øn m√¥i tr∆∞·ªùng 'CHUTES_AI_API_TOKEN' tr√™n Netlify.");
                return null;
            }

            try {
                const response = await fetch(CHUTES_AI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CHUTES_AI_API_TOKEN}` // G·ª≠i token c·ªßa Chutes AI
                    },
                    body: JSON.stringify({
                        // Model DeepSeek V3 0324 nh∆∞ trong h√¨nh ·∫£nh b·∫°n cung c·∫•p
                        model: "deepseek-ai/deepseek-v3-0324",
                        messages: [{ role: "user", content: promptContent }],
                        stream: false, // Kh√¥ng s·ª≠ d·ª•ng ch·∫ø ƒë·ªô streaming
                        max_tokens: 1024 // Gi·ªõi h·∫°n token ƒë·∫ßu ra
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("L·ªói API t·ª´ Chutes AI:", errorData);
                    showMessageModal(`L·ªói t·ª´ d·ªãch v·ª• Chutes AI: ${errorData.error?.message || response.statusText}. Vui l√≤ng ki·ªÉm tra token v√† th·ª≠ l·∫°i.`);
                    return null;
                }

                const result = await response.json();

                if (result.choices && result.choices.length > 0 &&
                    result.choices[0].message && result.choices[0].message.content) {
                    const aiContent = result.choices[0].message.content;

                    // C·ªë g·∫Øng parse n·ªôi dung AI th√†nh JSON
                    try {
                        const parsedAiResponse = JSON.parse(aiContent);

                        // X√°c th·ª±c c·∫•u tr√∫c JSON ƒë√£ parse
                        if (typeof parsedAiResponse.score === 'number' && Array.isArray(parsedAiResponse.reasons)) {
                            // ƒê·∫£m b·∫£o ƒëi·ªÉm s·ªë n·∫±m trong kho·∫£ng 0-100
                            parsedAiResponse.score = Math.max(0, Math.min(100, parsedAiResponse.score));
                            return { score: parsedAiResponse.score, reasons: parsedAiResponse.reasons };
                        } else {
                            console.error("C·∫•u tr√∫c JSON kh√¥ng h·ª£p l·ªá t·ª´ AI:", parsedAiResponse);
                            showMessageModal("Ph·∫£n h·ªìi t·ª´ AI kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng ph·∫£n h·ªìi c·ªßa AI.");
                            return null;
                        }
                    } catch (parseError) {
                        console.error("L·ªói khi parse n·ªôi dung AI th√†nh JSON:", parseError);
                        showMessageModal(`Kh√¥ng th·ªÉ parse ph·∫£n h·ªìi t·ª´ AI th√†nh JSON. Ph·∫£n h·ªìi th√¥: ${aiContent.substring(0, 200)}...`);
                        return null;
                    }
                } else {
                    showMessageModal("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi h·ª£p l·ªá t·ª´ AI qua Chutes AI. Vui l√≤ng th·ª≠ l·∫°i.");
                    return null;
                }
            } catch (error) {
                console.error("L·ªói khi g·ªçi ƒë·∫øn Chutes AI:", error);
                showMessageModal(`C√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh k·∫øt n·ªëi ƒë·∫øn d·ªãch v·ª• Chutes AI: ${error.message}. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi v√† th·ª≠ l·∫°i.`);
                return null;
            }
        }

        // --- C·∫≠p nh·∫≠t giao di·ªán ng∆∞·ªùi d√πng ---
        function displayResults(data) {
            DOM.inputTypeDisplay.textContent = data.inputType === 'url' ? 'Link URL' : 'VƒÉn b·∫£n';

            if (data.inputType === 'url') {
                DOM.resultInput.innerHTML = `<a href="${data.inputValue}" target="_blank" rel="noopener noreferrer" class="hover:underline">${data.inputValue}</a>`;
            } else {
                const displayText = data.inputValue.length > 200 ? data.inputValue.substring(0, 200) + "..." : data.inputValue;
                DOM.resultInput.textContent = displayText;
            }

            DOM.truthScore.textContent = `${data.analysisScore}%`;
            DOM.truthScore.className = 'score-badge '; // ƒê·∫∑t l·∫°i c√°c l·ªõp CSS
            if (data.analysisScore >= 70) DOM.truthScore.classList.add('score-real');
            else if (data.analysisScore <= 30) DOM.truthScore.classList.add('score-fake');
            else DOM.truthScore.classList.add('score-mid');

            DOM.explanationList.innerHTML = '';
            if (data.analysisReasons && data.analysisReasons.length > 0) {
                data.analysisReasons.forEach(reason => {
                    const li = document.createElement('li');
                    li.textContent = reason;
                    DOM.explanationList.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = "Kh√¥ng c√≥ gi·∫£i th√≠ch chi ti·∫øt t·ª´ AI.";
                DOM.explanationList.appendChild(li);
            }

            DOM.recommendationDiv.className = 'mt-4 p-3 border rounded-lg'; // ƒê·∫∑t l·∫°i c√°c l·ªõp CSS
            DOM.recommendationDiv.innerHTML = '';
            DOM.recommendationDiv.classList.remove('hidden'); // ƒê·∫£m b·∫£o hi·ªÉn th·ªã

            if (data.analysisScore < 50) {
                DOM.recommendationDiv.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
                DOM.recommendationDiv.innerHTML = '<p class="font-bold">‚ö†Ô∏è Khuy·∫øn ngh·ªã: ƒê·ªô tin c·∫≠y th·∫•p!</p><p>Th√¥ng tin n√†y c√≥ nhi·ªÅu d·∫•u hi·ªáu kh√¥ng ƒë√°ng tin c·∫≠y theo ph√¢n t√≠ch c·ªßa AI. B·∫°n kh√¥ng n√™n chia s·∫ª n·∫øu ch∆∞a ki·ªÉm ch·ª©ng t·ª´ c√°c c∆° quan nh√† n∆∞·ªõc, b√°o ch√≠ l·ªõn ho·∫∑c ngu·ªìn tin ch√≠nh th·ªëng, uy t√≠n.</p>';
            } else if (data.analysisScore < 70) {
                DOM.recommendationDiv.classList.add('bg-yellow-100', 'border-yellow-400', 'text-yellow-700');
                DOM.recommendationDiv.innerHTML = '<p class="font-bold">ü§î Khuy·∫øn ngh·ªã: C·∫ßn ki·ªÉm ch·ª©ng!</p><p>Th√¥ng tin n√†y c√≥ m·ªôt s·ªë y·∫øu t·ªë ch∆∞a r√µ r√†ng theo ph√¢n t√≠ch c·ªßa AI. B·∫°n n√™n ki·ªÉm tra th√™m t·ª´ c√°c ngu·ªìn ch√≠nh th·ªëng tr∆∞·ªõc khi chia s·∫ª.</p>';
            } else {
                DOM.recommendationDiv.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
                DOM.recommendationDiv.innerHTML = '<p class="font-bold">‚úÖ Khuy·∫øn ngh·ªã: C√≥ v·∫ª ƒë√°ng tin c·∫≠y!</p><p>Th√¥ng tin n√†y √≠t c√≥ d·∫•u hi·ªáu kh√¥ng ƒë√°ng tin c·∫≠y theo ph√¢n t√≠ch c·ªßa AI. Tuy nhi√™n, lu√¥n t·ªët nh·∫•t l√† tham kh·∫£o th√™m t·ª´ c√°c ngu·ªìn ch√≠nh th·ªëng kh√°c n·∫øu c√≥ th·ªÉ.</p>';
            }

            // ƒê·∫∑t l·∫°i tr·∫°ng th√°i n√∫t b√¨nh ch·ªçn
            DOM.voteButtons.forEach(btn => {
                btn.classList.remove('btn-primary', 'bg-green-500', 'bg-red-500', 'bg-yellow-500');
                btn.classList.add('btn-secondary');
                btn.disabled = false;
            });

            if (data.userVote) {
                const activeBtn = DOM.votingSection.querySelector(`[data-vote="${data.userVote}"]`);
                if (activeBtn) {
                    activeBtn.classList.remove('btn-secondary');
                    activeBtn.classList.add('btn-primary');
                    if (data.userVote === 'real') activeBtn.classList.add('bg-green-500');
                    else if (data.userVote === 'fake') activeBtn.classList.add('bg-red-500');
                    else if (data.userVote === 'unsure') activeBtn.classList.add('bg-yellow-500');
                }
                DOM.voteMessage.textContent = `B·∫°n ƒë√£ b√¨nh ch·ªçn: ${data.userVote === 'real' ? 'Tin Th·∫≠t' : data.userVote === 'fake' ? 'Tin Gi·∫£' : 'Kh√¥ng Ch·∫Øc'}.`;
            } else {
                DOM.voteMessage.textContent = '';
            }

            DOM.resultSection.classList.remove('hidden');
            DOM.loadingIndicator.classList.add('hidden');

            currentCheckedItem = data;
        }

        function renderHistory(items) {
            DOM.historyList.innerHTML = ''; // X√≥a l·ªãch s·ª≠ hi·ªán c√≥
            if (items.length === 0) {
                DOM.noHistoryMessage.classList.remove('hidden');
                return;
            }
            DOM.noHistoryMessage.classList.add('hidden');

            // S·∫Øp x·∫øp theo th·ªùi gian g·∫ßn nh·∫•t
            items.sort((a, b) => b.timestamp - a.timestamp);

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2';
                div.setAttribute('data-id', item.id); // Th√™m data-id ƒë·ªÉ ·ªßy quy·ªÅn s·ª± ki·ªán

                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'flex-grow min-w-0';

                const inputValDisplay = document.createElement('p');
                inputValDisplay.className = 'text-blue-600 hover:underline break-all font-medium truncate';
                if (item.inputType === 'url') {
                    inputValDisplay.innerHTML = `<a href="${item.inputValue}" target="_blank" rel="noopener noreferrer">${item.inputValue}</a>`;
                } else {
                    inputValDisplay.textContent = item.inputValue.substring(0,100) + (item.inputValue.length > 100 ? "..." : "");
                }
                detailsDiv.appendChild(inputValDisplay);

                const typeP = document.createElement('p');
                typeP.className = 'text-xs text-gray-500';
                typeP.textContent = `Lo·∫°i: ${item.inputType === 'url' ? 'Link URL' : 'VƒÉn b·∫£n'}`;
                detailsDiv.appendChild(typeP);

                const scoreP = document.createElement('p');
                scoreP.className = 'text-sm text-gray-600 mt-1';
                scoreP.innerHTML = `ƒêi·ªÉm: <span class="score-badge ${item.analysisScore >= 70 ? 'score-real' : item.analysisScore <= 30 ? 'score-fake' : 'score-mid'}">${item.analysisScore}%</span>`;
                detailsDiv.appendChild(scoreP);

                if (item.userVote) {
                    const voteP = document.createElement('p');
                    voteP.className = 'text-sm text-gray-600 mt-1';
                    let voteText = '';
                    if (item.userVote === 'real') voteText = 'üëç Tin Th·∫≠t';
                    else if (item.userVote === 'fake') voteText = 'üëé Tin Gi·∫£';
                    else if (item.userVote === 'unsure') voteText = 'ü§î Kh√¥ng Ch·∫Øc';
                    voteP.textContent = `B√¨nh ch·ªçn: ${voteText}`;
                    detailsDiv.appendChild(voteP);
                }

                const dateP = document.createElement('p');
                dateP.className = 'text-xs text-gray-400 mt-1';
                dateP.textContent = new Date(item.timestamp).toLocaleString('vi-VN');
                detailsDiv.appendChild(dateP);

                div.appendChild(detailsDiv);

                const viewBtn = document.createElement('button');
                viewBtn.textContent = 'Xem l·∫°i';
                viewBtn.className = 'btn btn-secondary btn-sm mt-2 sm:mt-0 flex-shrink-0 view-history-btn'; // Th√™m l·ªõp ƒë·ªÉ ·ªßy quy·ªÅn
                viewBtn.setAttribute('data-id', item.id); // Th√™m data-id ƒë·ªÉ ·ªßy quy·ªÅn
                div.appendChild(viewBtn);

                DOM.historyList.appendChild(div);
            });
        }

        // --- Thao t√°c v·ªõi Local Storage ---
        function getHistoryItems() {
            try {
                const historyJson = localStorage.getItem(LOCAL_STORAGE_KEY);
                return historyJson ? JSON.parse(historyJson) : [];
            } catch (e) {
                console.error("L·ªói khi parse l·ªãch s·ª≠ t·ª´ Local Storage:", e);
                return [];
            }
        }

        function saveHistoryItem(item) {
            const items = getHistoryItems();
            item.id = Date.now().toString(); // ID duy nh·∫•t cho m·ªói m·ª•c
            items.push(item);
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(items));
            renderHistory(items); // Hi·ªÉn th·ªã l·∫°i l·ªãch s·ª≠ sau khi l∆∞u
        }

        function updateHistoryItem(updatedItem) {
            let items = getHistoryItems();
            const index = items.findIndex(item => item.id === updatedItem.id);
            if (index !== -1) {
                items[index] = updatedItem;
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(items));
                renderHistory(items); // Hi·ªÉn th·ªã l·∫°i l·ªãch s·ª≠ sau khi c·∫≠p nh·∫≠t
            }
        }

        function loadHistory() {
            const items = getHistoryItems();
            renderHistory(items);
        }

        // --- X·ª≠ l√Ω s·ª± ki·ªán ---
        async function handleSubmit() {
            let inputValue = '';
            let isValid = true;

            DOM.urlInputError.textContent = "";
            DOM.textInputError.textContent = "";

            if (currentInputType === 'url') {
                inputValue = DOM.urlInput.value.trim();
                if (!inputValue) {
                    DOM.urlInputError.textContent = "Vui l√≤ng nh·∫≠p URL.";
                    isValid = false;
                } else {
                    try {
                        new URL(inputValue); // X√°c th·ª±c ƒë·ªãnh d·∫°ng URL
                    } catch (_) {
                        DOM.urlInputError.textContent = "URL kh√¥ng h·ª£p l·ªá. (v√≠ d·ª•: https://example.com)";
                        isValid = false;
                    }
                }
            } else if (currentInputType === 'text') {
                inputValue = DOM.textInput.value.trim();
                if (!inputValue) {
                    DOM.textInputError.textContent = "Vui l√≤ng nh·∫≠p n·ªôi dung vƒÉn b·∫£n.";
                    isValid = false;
                } else if (inputValue.length < 20) {
                    DOM.textInputError.textContent = "N·ªôi dung vƒÉn b·∫£n qu√° ng·∫Øn (√≠t nh·∫•t 20 k√Ω t·ª±).";
                    isValid = false;
                }
            }

            if (!isValid) return; // D·ª´ng n·∫øu ƒë·∫ßu v√†o kh√¥ng h·ª£p l·ªá

            // Hi·ªÉn th·ªã ch·ªâ b√°o t·∫£i v√† ·∫©n k·∫øt qu·∫£
            DOM.loadingIndicator.classList.remove('hidden');
            DOM.resultSection.classList.add('hidden');
            DOM.voteMessage.textContent = '';

            // G·ªçi ph√¢n t√≠ch t·ª´ Chutes AI
            const analysis = await callChutesAIAnalysis(currentInputType, inputValue);

            if (!analysis) {
                // Th√¥ng b√°o l·ªói ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã b·ªüi callChutesAIAnalysis
                DOM.loadingIndicator.classList.add('hidden');
                return;
            }

            const newItem = {
                inputType: currentInputType,
                inputValue: inputValue,
                analysisScore: analysis.score,
                analysisReasons: analysis.reasons,
                userVote: null,
                timestamp: Date.now()
            };

            saveHistoryItem(newItem);
            displayResults(newItem);
            scrollToElement(DOM.resultSection); // Cu·ªôn ƒë·∫øn k·∫øt qu·∫£ sau khi hi·ªÉn th·ªã

            // X√≥a tr∆∞·ªùng nh·∫≠p li·ªáu sau khi g·ª≠i th√†nh c√¥ng
            if (currentInputType === 'url') DOM.urlInput.value = "";
            else DOM.textInput.value = "";
        }

        function handleVote(event) {
            const button = event.target.closest('.vote-btn');
            if (!button) return; // ƒê·∫£m b·∫£o n√∫t b√¨nh ch·ªçn ƒë√£ ƒë∆∞·ª£c nh·∫•p

            if (!currentCheckedItem) {
                showMessageModal("Vui l√≤ng ki·ªÉm tra m·ªôt m·ª•c tr∆∞·ªõc khi b√¨nh ch·ªçn.");
                return;
            }
            const vote = button.dataset.vote;

            // C·∫≠p nh·∫≠t m·ª•c hi·ªán t·∫°i v√† l∆∞u v√†o l·ªãch s·ª≠
            currentCheckedItem.userVote = vote;
            currentCheckedItem.timestamp = Date.now(); // C·∫≠p nh·∫≠t timestamp ƒë·ªÉ ƒë∆∞a l√™n ƒë·∫ßu l·ªãch s·ª≠
            updateHistoryItem(currentCheckedItem);

            // C·∫≠p nh·∫≠t giao di·ªán cho th√¥ng b√°o b√¨nh ch·ªçn
            DOM.voteMessage.textContent = `C·∫£m ∆°n b·∫°n ƒë√£ b√¨nh ch·ªçn: ${vote === 'real' ? 'Tin Th·∫≠t' : vote === 'fake' ? 'Tin Gi·∫£' : 'Kh√¥ng Ch·∫Øc'}!`;
            // C·∫≠p nh·∫≠t giao di·ªán cho c√°c n√∫t b√¨nh ch·ªçn
            DOM.voteButtons.forEach(btn => {
                btn.classList.remove('btn-primary', 'bg-green-500', 'bg-red-500', 'bg-yellow-500');
                btn.classList.add('btn-secondary');
                if (btn.dataset.vote === vote) {
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-primary');
                    if (vote === 'real') btn.classList.add('bg-green-500');
                    else if (vote === 'fake') btn.classList.add('bg-red-500');
                    else if (vote === 'unsure') btn.classList.add('bg-yellow-500');
                }
            });
        }

        function handleHistoryItemClick(event) {
            const viewButton = event.target.closest('.view-history-btn');
            if (!viewButton) return;

            const itemId = viewButton.dataset.id;
            const items = getHistoryItems();
            const itemToDisplay = items.find(item => item.id === itemId);

            if (itemToDisplay) {
                displayResults(itemToDisplay);
                scrollToElement(DOM.resultSection);
            }
        }

        function toggleMobileMenu() {
            DOM.mobileMenu.classList.toggle('hidden');
        }

        // --- Kh·ªüi t·∫°o c√°c tr√¨nh nghe s·ª± ki·ªán ---
        function initEventListeners() {
            DOM.tabUrlBtn.addEventListener('click', () => switchTab('url'));
            DOM.tabTextBtn.addEventListener('click', () => switchTab('text'));
            DOM.submitBtn.addEventListener('click', () => debounce(handleSubmit, 300)); // Debounce submit

            DOM.modalCloseBtn.addEventListener('click', () => DOM.messageModal.classList.remove('active'));

            DOM.votingSection.addEventListener('click', handleVote); // ·ª¶y quy·ªÅn s·ª± ki·ªán cho c√°c n√∫t b√¨nh ch·ªçn
            DOM.historyList.addEventListener('click', handleHistoryItemClick); // ·ª¶y quy·ªÅn s·ª± ki·ªán cho c√°c n√∫t l·ªãch s·ª≠

            DOM.mobileMenuButton.addEventListener('click', toggleMobileMenu);
        }

        // --- Thi·∫øt l·∫≠p ban ƒë·∫ßu ---
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            switchTab('url'); // ƒê·∫∑t tab ban ƒë·∫ßu
            loadHistory();    // T·∫£i l·ªãch s·ª≠ khi trang t·∫£i
        });
    </script>
</body>
</html>
